# Story 2.1: Form Controls Migration to Radix UI

## Status

Draft

## Story

**As a** prospective student or parent using the SCISS application form,
**I want** to interact with modern, accessible form controls that maintain the familiar SCISS design while providing enhanced functionality,
**so that** I experience improved usability, better accessibility, and more reliable form interactions without losing the visual consistency I expect.

## Acceptance Criteria

1. **Select Component Migration**: Replace native select elements with Radix Select while preserving existing styling
2. **Enhanced Accessibility**: All form controls meet WCAG 2.1 AA standards with improved keyboard navigation
3. **Design System Preservation**: Maintain all existing CSS custom properties and visual design language
4. **Animation Integration**: Apply Epic 1 interaction enhancements to new Radix components
5. **Dropdown Functionality**: Improved dropdown behavior with search, grouping, and better mobile experience
6. **Form Validation Integration**: Seamless integration with existing Zod validation and error display
7. **Performance Optimization**: Maintain or improve form rendering and interaction performance

## Tasks / Subtasks

- [ ] **Task 1: Radix UI Setup & Integration** (AC: 1, 3)

  - [ ] Install Radix UI form primitive packages (@radix-ui/react-select, @radix-ui/react-checkbox, etc.)
  - [ ] Create CSS integration strategy for Radix components with existing design tokens
  - [ ] Set up Radix component styling approach (CSS modules or styled-components integration)
  - [ ] Configure Radix with existing TypeScript strict mode requirements

- [ ] **Task 2: Select Component Migration** (AC: 1, 2, 5)

  - [ ] Replace gender selection with Radix Select component
  - [ ] Migrate grade level selection to Radix Select with enhanced styling
  - [ ] Convert country/state selectors with improved search functionality
  - [ ] Apply existing form field styling to Radix Select components
  - [ ] Implement keyboard navigation and screen reader support
  - [ ] Add mobile-optimized dropdown behavior

- [ ] **Task 3: Checkbox & Radio Migration** (AC: 2, 4, 6)

  - [ ] Convert course selection radio buttons to Radix RadioGroup
  - [ ] Migrate sports checkboxes to Radix Checkbox components
  - [ ] Apply Epic 1 enhanced interaction states to new components
  - [ ] Integrate form validation animations with Radix state management
  - [ ] Maintain existing validation error display patterns

- [ ] **Task 4: Enhanced Dropdown Features** (AC: 5, 7)

  - [ ] Add search functionality to country/state selectors
  - [ ] Implement option grouping for better organization
  - [ ] Create custom option rendering for complex selections
  - [ ] Add keyboard shortcuts for power users
  - [ ] Optimize dropdown performance for large option lists

- [ ] **Task 5: Design System Integration** (AC: 3, 4)

  - [ ] Create Radix component CSS classes using existing design tokens
  - [ ] Apply consistent spacing, typography, and color schemes
  - [ ] Integrate Epic 1 animation timings and transitions
  - [ ] Maintain visual hierarchy and focus indicators
  - [ ] Ensure responsive design consistency

- [ ] **Task 6: Validation & Error Handling** (AC: 6, 7)
  - [ ] Integrate Radix components with useApplicationForm hook
  - [ ] Maintain Zod schema validation compatibility
  - [ ] Apply Epic 1.2 form validation animations to Radix components
  - [ ] Test error state styling and accessibility
  - [ ] Ensure proper form submission behavior

## Dev Notes

### Technical Context from Architecture

**Current Form Implementation**: [Source: .cursor/docs/architect.md#form-validation-architecture]

- ApplicationForm.js: 700+ line sophisticated form with native HTML controls
- useApplicationForm hook: Custom state management with Zod validation
- Form controls: Native selects, checkboxes, radio buttons, text inputs
- Validation: Real-time email validation, complex conditional logic

**Existing Form Controls to Migrate**:

```javascript
// Current native implementations that need Radix migration
<select name="gender" value={formValues.gender}>
  <option value="">Select</option>
  {formOptions.genderOptions.map(option => ...)}
</select>

<input type="radio" name="course" value={option.value} />
<input type="checkbox" name="sports" value={option.value} />
```

**Design System Foundation**: [Source: .cursor/docs/architect.md#css-architecture]

- CSS custom properties: 50+ semantic variables for consistent theming
- Form styling: `src/styles/components/application-form.css`
- Color system: `--primary-blue`, `--error-color`, `--success-color`
- Interaction states: Enhanced hover, focus, active states from Epic 1.1

**Epic 1 Integration Points**: [Source: Stories 1.1, 1.2]

- Button interaction enhancements: Apply to Radix trigger elements
- Form validation animations: Integrate with Radix state management
- Consistent timing functions: `cubic-bezier(0.4, 0, 0.2, 1)`
- Accessibility improvements: Enhanced focus indicators and screen reader support

### Radix UI Migration Strategy

**Component Mapping Strategy**:

```javascript
// Migration plan for each form control type
const migrationPlan = {
  'select[name="gender"]': "Radix Select",
  'select[name="grade"]': "Radix Select with search",
  'select[name="country"]': "Radix Select with search + grouping",
  'input[type="radio"][name="course"]': "Radix RadioGroup",
  'input[type="checkbox"][name="sports"]': "Radix Checkbox",
  fieldset: "Radix Fieldset for logical grouping",
};
```

**Styling Approach**:

```css
/* Radix component styling with existing design tokens */
.radix-select-trigger {
  padding: 0.7rem 1rem;
  border: 1px solid var(--border-light);
  border-radius: 6px;
  background: var(--background-secondary);
  color: var(--text-dark);
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.radix-select-trigger:hover {
  border-color: var(--secondary-blue);
}

.radix-select-trigger:focus {
  outline: 2px solid var(--accent-yellow);
  outline-offset: 2px;
}
```

**Enhanced Functionality with Radix**:

- Better keyboard navigation (Arrow keys, Enter, Escape, typing to search)
- Improved screen reader announcements and ARIA support
- Custom option rendering for complex data (flags for countries, icons for courses)
- Better mobile experience with native behavior fallbacks
- Enhanced performance with virtualization for large lists

### Form Integration Architecture

**useApplicationForm Hook Integration**:

```javascript
// Enhanced hook to support Radix components
const useApplicationForm = () => {
  // ... existing functionality

  // New Radix-specific handlers
  const onRadixSelectChange = (name, value) => {
    setFormValues((prev) => ({ ...prev, [name]: value }));
    // Trigger validation and animations
  };

  const onRadixCheckboxChange = (name, checked, value) => {
    // Handle multi-select checkbox arrays
    setFormValues((prev) => ({
      ...prev,
      [name]: checked
        ? [...prev[name], value]
        : prev[name].filter((v) => v !== value),
    }));
  };

  return {
    // ... existing returns
    onRadixSelectChange,
    onRadixCheckboxChange,
    // Radix-compatible validation states
  };
};
```

**Performance Considerations**: [Source: .cursor/docs/architect.md#performance-focus]

- Lazy loading of option lists for large datasets
- Virtualization for country/state dropdowns (200+ options)
- Debounced search functionality to prevent excessive filtering
- Memoized option rendering for complex custom options

### Testing Strategy

**Testing Standards**: [Source: .cursor/docs/architect.md#testing-infrastructure]

- Test framework: Jest + React Testing Library
- Component testing: Radix component behavior, accessibility, integration
- Test location: `src/components/forms/__tests__/RadixFormControls.test.js`

**Specific Testing Requirements for This Story**:

- Radix component behavior: Open/close, selection, keyboard navigation
- Form integration: Value updates, validation triggers, error display
- Accessibility: Screen reader announcements, keyboard navigation, focus management
- Performance: Large option list handling, search functionality
- Visual regression: Ensure design consistency with existing form styling
- Cross-browser: Radix component compatibility across target browsers

### Migration Rollout Strategy

**Phase 1**: Select components (gender, grade, country/state)
**Phase 2**: Radio groups (course selection)
**Phase 3**: Checkbox arrays (sports selection)
**Phase 4**: Enhanced features (search, grouping, custom rendering)

**Rollback Plan**: Maintain parallel implementation during testing phase with feature flag to switch between native and Radix components.

## Change Log

| Date       | Version | Description                                                 | Author           |
| ---------- | ------- | ----------------------------------------------------------- | ---------------- |
| 2024-12-19 | 1.0     | Initial story creation for Radix UI form controls migration | Scrum Master Bob |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

## QA Results

_This section will be populated by the QA agent after implementation review_
